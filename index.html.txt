<!DOCTYPE html>
<html lang="id">

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Reservasi Restaurant</title>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

</head>

<body>

<div class="container">

<h2>Form Reservasi Restaurant</h2>

<form id="reservationForm">

<label>Nama Tamu</label>
<input type="text" id="guest_name" required>

<label>Nomor Telepon / WhatsApp</label>
<input type="text" id="phone" required>

<label>Email (Opsional)</label>
<input type="email" id="email">

<label>Tanggal Reservasi</label>
<input type="date" id="reservation_date" required>

<label>Waktu Kedatangan</label>
<select id="reservation_time" required>

<option value="">Pilih Waktu</option>

<option value="10:00">10:00</option>
<option value="12:00">12:00</option>
<option value="14:00">14:00</option>
<option value="16:00">16:00</option>
<option value="18:00">18:00</option>
<option value="20:00">20:00</option>

</select>

<label>Jumlah Tamu</label>
<input type="number" id="guest_count" min="1" required>

<label>Pilihan Cabang</label>
<select id="branch_id" required>
<option value="">Pilih Cabang</option>
</select>

<label>Pilihan Lantai</label>
<select id="floor_id" required>
<option value="">Pilih Lantai</option>
</select>

<label>Pilihan Meja</label>
<select id="table_id" required>
<option value="">Pilih Meja</option>
</select>

<label>Jenis Acara</label>
<select id="event_type">

<option value="Dinner">Dinner</option>
<option value="Birthday">Birthday</option>
<option value="Meeting">Meeting</option>
<option value="Anniversary">Anniversary</option>
<option value="Lainnya">Lainnya</option>

</select>

<label>Permintaan Khusus</label>
<textarea id="special_request"></textarea>

<label>Catatan Tambahan</label>
<textarea id="notes"></textarea>

<button type="submit">
Kirim Reservasi
</button>

</form>

<div id="message"></div>

</div>

<script>

async function loadBranches(){

const { data, error } =
await supabase
.from("branches")
.select("*")
.eq("active", true)

if(data){

const select =
document.getElementById("branch_id")

data.forEach(branch => {

const option =
document.createElement("option")

option.value = branch.id
option.text = branch.name

select.appendChild(option)

})

}

}

loadBranches()

document
.getElementById("reservationForm")
.addEventListener("submit", async function(e){

e.preventDefault()

const message =
document.getElementById("message")

message.innerHTML = "Menyimpan reservasi..."

const data = {

guest_name:
document.getElementById("guest_name").value,

phone:
document.getElementById("phone").value,

email:
document.getElementById("email").value,

reservation_date:
document.getElementById("reservation_date").value,

reservation_time:
document.getElementById("reservation_time").value,

guest_count:
document.getElementById("guest_count").value,

branch_id:
document.getElementById("branch_id").value,

floor_id:
document.getElementById("floor_id").value,

table_id:
document.getElementById("table_id").value,

event_type:
document.getElementById("event_type").value,

special_request:
document.getElementById("special_request").value,

notes:
document.getElementById("notes").value,

status: "pending"

}

const { error } =
await supabase
.from("reservations")
.insert([data])

if(error){

message.innerHTML =
"<span class='error'>Gagal menyimpan reservasi</span>"

}else{

message.innerHTML =
"<span class='success'>Reservasi berhasil dikirim. Menunggu konfirmasi admin.</span>"

document
.getElementById("reservationForm")
.reset()

}

})

</script>

</body>
</html>
